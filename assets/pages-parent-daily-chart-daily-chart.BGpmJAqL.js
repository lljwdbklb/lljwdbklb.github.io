import{d as e,r as a,p as t,E as s,c as l,w as r,q as i,u as o,i as c,o as n,a as d,e as u,v as h,t as g,S as m,x as v,k as f,j as p,F as x,l as _,y as w,b as y}from"./index-p-adsUdp.js";import T from"./u-charts.min.js";import{a as b,c as k}from"./data-utils.CYepGN39.js";import{W as M}from"./config.BYcWPge6.js";import{_ as S}from"./plugin-vueexport-helper.BCo6x5W8.js";const F=S(e({__name:"daily-chart",setup(e){const S=a([]),F=a([]),P=a("00:00"),C=a(0),L=a("00:00"),j=a(0),D=a(null),z=a(null);let $=null,A=null;const R=a(!1),G=()=>{R.value=!R.value,R.value?S.value=[...F.value]:S.value=F.value.slice(0,7)},N=e=>{const a={categories:e.map(e=>e.dateLabel),series:[{name:"佩戴时长",data:e.map(e=>e.wearTimeMinutes/60),color:"#1890ff"},{name:"目标时长",data:e.map(()=>M.targetTime),color:"#ff4d4f",type:"line"}]},t=80*e.length+100,s=i();s.select("#wearTimeChart").fields({node:!0,size:!0}),s.exec(e=>{if(e&&e[0]&&e[0].node){const l=e[0].node,r=l.getContext("2d",{alpha:!0});if(o(),!r)return void console.error("无法获取佩戴时长图表的canvas上下文");e[0].width;const i=e[0].height,c=300,n=200,d=Math.max(t,c),u=Math.max(i||0,n);l.width=d,l.height=u;try{const e={context:r,canvas:l,width:d,height:u,type:"column",fontSize:12,legend:!0,dataLabel:!0,dataPointShape:!0,background:"#FFFFFF",pixelRatio:1,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,rotateLabel:30},yAxis:{gridType:"dash",dashLength:2,splitNumber:5},extra:{column:{width:12},line:{type:"straight",width:2}}};if(!e)return void console.error("佩戴时长图表options为空");console.log("佩戴时长图表初始化参数:",e),$=new T(e),console.log("佩戴时长图表初始化成功，尺寸：",d,"x",u)}catch(s){console.error("佩戴时长图表初始化失败:",s)}}else console.error("无法获取佩戴时长图表的canvas元素",e)})},q=e=>{const a={categories:e.map(e=>e.dateLabel),series:[{name:"平均压力",data:e.map(e=>e.avgPressure),color:"#52c41a"}]};e.length;const t=i();t.select("#pressureChart").fields({node:!0,size:!0}),t.exec(e=>{if(e&&e[0]&&e[0].node){const s=e[0].node,l=s.getContext("2d",{alpha:!0});if(o(),!l)return void console.error("无法获取压力趋势图表的canvas上下文");e[0].width;const r=e[0].height,i=200,c=600,n=Math.max(r||0,i);s.width=c,s.height=n;try{const e={context:l,canvas:s,width:c,height:n,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:1,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,rotateLabel:30},yAxis:{gridType:"dash",dashLength:2,splitNumber:5},extra:{line:{type:"straight",width:1.5},point:{size:3}}};if(!e)return void console.error("压力趋势图表options为空");console.log("压力趋势图表初始化参数:",e),A=new T(e),console.log("压力趋势图表初始化成功，尺寸：",c,"x",n)}catch(t){console.error("压力趋势图表初始化失败:",t)}}else console.error("无法获取压力趋势图表的canvas元素",e)})};return t(()=>{const e=(()=>{const e=[],a=new Date;for(let n=29;n>=0;n--){const t=new Date(a);t.setDate(t.getDate()-n);const s=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0"),l=b(s),r=l.filter(e=>e.worn).length,i=l.filter(e=>e.worn).reduce((e,a)=>e+a.pressure,0),o=30*r,c=r>0?Math.round(i/r):0,d=Math.floor(o/60),u=o%60,h=`${String(d).padStart(2,"0")}:${String(u).padStart(2,"0")}`;let g="abnormal",m="未达标";d>=M.targetTime&&(g="normal",m="已达标");const v=d<M.targetTime?k(o):"";e.push({date:s,dateLabel:String(t.getMonth()+1)+"/"+String(t.getDate()),wearTime:h,wearTimeMinutes:o,avgPressure:c,status:g,statusText:m,remainingTime:v})}F.value=e,S.value=e.slice(0,7);const t=e.slice(0,7),s=t.reduce((e,a)=>e+a.wearTimeMinutes,0),l=t.length,r=Math.round(s/l),i=t.filter(e=>"normal"===e.status).length,o=Math.floor(r/60);P.value=`${o}小时`,C.value=Math.round(i/l*100);const c=Math.floor(s/60);return L.value=`${c}小时`,j.value=Math.round(t.reduce((e,a)=>e+a.avgPressure,0)/l),t})();console.log("生成的数据:",e),setTimeout(()=>{try{N(e),q(e)}catch(a){console.error("图表初始化失败:",a)}},300)}),s(()=>{setTimeout(()=>{S.value.length>0&&(N(S.value),q(S.value))},100)}),(e,a)=>{const t=c,s=v,i=m,o=y;return n(),l(t,{class:"daily-chart-page"},{default:r(()=>[d(t,{class:"page-header"},{default:r(()=>[d(t,{class:"date-range"},{default:r(()=>[d(t,{class:"range-text"},{default:r(()=>[u("最近7天")]),_:1})]),_:1})]),_:1}),d(t,{class:"stats-overview"},{default:r(()=>[d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},g(P.value),1),h("div",{class:"stat-label"},"平均佩戴时长/天")]),_:1}),d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},g(C.value)+"%",1),h("div",{class:"stat-label"},"每日达标率")]),_:1}),d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},g(L.value),1),h("div",{class:"stat-label"},"总佩戴时长")]),_:1}),d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},g(j.value)+" kPa",1),h("div",{class:"stat-label"},"平均压力值")]),_:1})]),_:1}),d(t,{class:"charts-section"},{default:r(()=>[d(t,{class:"chart-card"},{default:r(()=>[h("h2",{class:"chart-title"},"每日佩戴时长"),d(i,{class:"chart-container","scroll-x":"true","enable-flex":"true","show-scrollbar":"false"},{default:r(()=>[d(s,{ref_key:"wearTimeChartRef",ref:D,id:"wearTimeChart",class:"chart"},null,512)]),_:1})]),_:1}),d(t,{class:"chart-card"},{default:r(()=>[h("h2",{class:"chart-title"},"每日压力趋势"),d(i,{class:"chart-container","scroll-x":"true","enable-flex":"true","show-scrollbar":"false"},{default:r(()=>[d(s,{ref_key:"pressureChartRef",ref:z,id:"pressureChart",class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),d(t,{class:"daily-list"},{default:r(()=>[h("h2",{class:"section-title"},"每日详情"),d(t,{class:"list-items"},{default:r(()=>[(n(!0),f(x,null,_(R.value?F.value.slice(0,7):S.value,e=>(n(),l(t,{key:e.date,class:w(["list-item",e.status])},{default:r(()=>[d(t,{class:"item-left"},{default:r(()=>[h("div",{class:"item-date"},g(e.date),1),h("div",{class:"item-status"},g(e.statusText),1)]),_:2},1024),d(t,{class:"item-right"},{default:r(()=>[h("div",{class:"item-time"},g(e.wearTime),1),h("div",{class:"item-pressure"},g(e.avgPressure)+"kPa",1),e.remainingTime?(n(),f("div",{key:0,class:"item-remaining"},g(e.remainingTime),1)):p("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128)),F.value.length>7?(n(),l(t,{key:0,class:"history-toggle",onClick:G},{default:r(()=>[d(t,{class:"toggle-content"},{default:r(()=>[d(o,null,{default:r(()=>[u(g(R.value?"收起历史记录":`展开${F.value.length-7}条历史记录`),1)]),_:1}),d(t,{class:w(["toggle-icon",{expanded:R.value}])},{default:r(()=>[u("▼")]),_:1},8,["class"])]),_:1})]),_:1})):p("",!0),R.value?(n(),l(t,{key:1,class:"history-list"},{default:r(()=>[(n(!0),f(x,null,_(F.value.slice(7),e=>(n(),l(t,{key:e.date,class:w(["list-item history-item",e.status])},{default:r(()=>[d(t,{class:"item-left"},{default:r(()=>[h("div",{class:"item-date"},g(e.date),1),h("div",{class:"item-status"},g(e.statusText),1)]),_:2},1024),d(t,{class:"item-right"},{default:r(()=>[h("div",{class:"item-time"},g(e.wearTime),1),h("div",{class:"item-pressure"},g(e.avgPressure)+"kPa",1),e.remainingTime?(n(),f("div",{key:0,class:"item-remaining"},g(e.remainingTime),1)):p("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-d7464903"]]);export{F as default};
