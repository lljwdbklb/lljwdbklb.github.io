import{d as a,r as e,g as t,m as s,C as l,z as n,A as r,c as o,w as c,P as u,D as i,p as d,_ as f,q as h,i as g,o as v,a as w,h as m,e as p,v as _,t as y,y as x,E as M}from"./index-BEpFFJ6X.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=b(a({__name:"realtime-monitor",setup(a){const b=e(!1),D=e(0),S=e("safe"),C=e("worn"),$=e(75),A=e("01:30"),E=e("00:00"),k=e([]),F=e(null);let P=null,j=!1;const L=t(()=>{if(0===k.value.length)return 0;const a=k.value.slice(-20),e=a.reduce((a,e)=>a+e,0);return Math.round(e/a.length*10)/10}),I=t(()=>{switch(S.value){case"safe":default:return"safe";case"warning":return"warning";case"danger":return"danger"}}),O=t(()=>{switch(S.value){case"safe":return"压力正常";case"warning":return"压力偏高";case"danger":return"压力异常";default:return"未知"}}),R=t(()=>{switch(C.value){case"worn":default:return"worn";case"not-worn":return"not-worn";case"abnormal":return"abnormal"}}),z=t(()=>{switch(C.value){case"worn":return"已佩戴";case"not-worn":return"未佩戴";case"abnormal":return"佩戴异常";default:return"未知"}}),q=t(()=>{const a=u,e=a.normalMax-a.normalMin;let t=(D.value-a.normalMin)/e*100;return t=Math.max(0,Math.min(100,t)),{left:`${t}%`}}),N=t(()=>({width:`${$.value}%`})),T=()=>{const a=u,e=a.normalMin,t=a.normalMax,s=Math.floor(Math.random()*(t-e+1))+e;D.value=s;const l=u;s>l.warningMax?S.value="danger":s<l.warningMin?S.value="warning":S.value="safe";const n=new Date,r=n.getHours().toString().padStart(2,"0"),o=n.getMinutes().toString().padStart(2,"0");E.value=`${r}:${o}`,k.value.length>50&&k.value.shift(),k.value.push(s),G()},G=()=>{try{if(!P)return j?void console.warn("图表正在初始化中，跳过本次更新"):(console.warn("图表实例未初始化，正在尝试重新初始化..."),j=!0,void H().then(a=>{j=!1,a?G():console.error("图表初始化失败，无法更新")}).catch(a=>{j=!1,console.error("图表初始化异常:",a)}));if(0===k.value.length)return;const a=k.value.slice(-20),e={categories:a.map((a,e)=>`#${e+1}`),series:[{name:"压力值",data:a,color:"#1890ff"}]};console.log("图表实例方法:",Object.keys(P)),"function"==typeof P.updateData?(console.log("使用updateData方法更新图表"),P.updateData(e)):"function"==typeof P.setData?(console.log("使用setData方法更新图表"),P.setData(e)):"function"==typeof P.draw?(console.log("使用draw方法更新图表"),P.draw(e)):console.error("图表实例缺少更新数据的方法")}catch(a){console.error("更新图表失败:",a)}},H=async()=>{if(j)return console.warn("图表正在初始化中，跳过本次初始化"),!1;j=!0;try{console.log("开始初始化图表..."),await i();const a=await new Promise((a,e)=>{if(F.value){const t=F.value.canvas||F.value;t?a({node:t,width:t.width||300,height:t.height||200}):e(new Error("无法从ref获取canvas元素"))}else{d().select("#pressureChart").fields({node:!0,size:!0}).exec(t=>{Array.isArray(t)&&t.length>0&&t[0]&&t[0].node?a({node:t[0].node,width:t[0].width||300,height:t[0].height||200}):e(new Error("无法获取canvas元素"))})}});console.log("canvas查询结果:",a);const e=a.node,t=e.getContext("2d");if(!t)throw new Error("无法获取canvas 2D上下文");let s=a.width,l=a.height;0!==s&&0!==l||(console.warn("Canvas尺寸为0，使用默认尺寸"),s=300,l=200,e.width=s,e.height=l),console.log("Canvas信息:",{width:s,height:l,ctx:!!t});const n=k.value.length>0?k.value.slice(-20):Array.from({length:20},(a,e)=>Math.floor(20*Math.random())+10),r={categories:n.map((a,e)=>`#${e+1}`),series:[{name:"压力值",data:n,color:"#1890ff"}]};console.log("图表初始化数据:",r);const o=await f(()=>import("..-node_modules-@qiun-ucharts-u-charts.Bc6tG3QR.js"),[]),c=o.default||o;if(console.log("uCharts模块导入结果:",typeof c),"function"!=typeof c)throw new Error("uCharts导入失败，不是一个构造函数");const g={context:t,type:"line",fontSize:12,legend:!1,dataLabel:!1,dataPointShape:!1,background:"#FFFFFF",pixelRatio:h().pixelRatio,categories:r.categories,series:r.series,animation:!0,xAxis:{disableGrid:!0,axisLine:!1,axisLabel:!1},yAxis:{gridType:"dash",dashLength:2,splitNumber:5,min:u.normalMin,max:u.normalMax},width:s,height:l,extra:{line:{type:"straight",width:2}}};return console.log("准备创建图表实例，配置:",JSON.stringify(g,(a,e)=>"context"===a?"[CanvasRenderingContext2D]":e)),P=new c(g),console.log("图表实例创建成功:",P),console.log("图表实例方法:",Object.keys(P)),!0}catch(a){return console.error("初始化图表失败:",a),P=null,!1}finally{j=!1}};let J;return s(async()=>{l(),b.value=n();try{await H(),console.log("图表初始化成功")}catch(e){console.error("图表初始化失败:",e)}T();let a=Date.now();J=setInterval(()=>{if(T(),Math.random()>.98&&(b.value=!b.value),Math.random()>.97){const e=["worn","not-worn","abnormal"],t=e[Math.floor(Math.random()*e.length)];"worn"!==C.value&&"worn"===t&&(a=Date.now()),C.value=t}if("worn"===C.value){const e=Date.now()-a,t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4);A.value=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}Math.random()>.99&&($.value=Math.max(0,$.value-1))},2e3)}),r(()=>{J&&clearInterval(J)}),(a,e)=>{const t=g;return v(),o(t,{class:"realtime-monitor-page"},{default:c(()=>[w(t,{class:"page-header"},{default:c(()=>[b.value?(v(),o(t,{key:0,class:"monitor-status"},{default:c(()=>[w(t,{class:"status-dot connected"}),w(t,{class:"status-text"},{default:c(()=>[p("实时更新")]),_:1})]),_:1})):m("",!0)]),_:1}),w(t,{class:"main-content"},{default:c(()=>[w(t,{class:"pressure-section"},{default:c(()=>[w(t,{class:"pressure-header"},{default:c(()=>[_("h2",{class:"section-title"},"实时压力值"),w(t,{class:"update-time"},{default:c(()=>[p("最后更新: "+y(E.value),1)]),_:1})]),_:1}),w(t,{class:"pressure-display"},{default:c(()=>[w(t,{class:"pressure-value"},{default:c(()=>[p(y(D.value),1)]),_:1}),w(t,{class:"pressure-unit"},{default:c(()=>[p("kPa")]),_:1})]),_:1}),w(t,{class:x(["pressure-status",I.value])},{default:c(()=>[w(t,{class:"status-icon"}),w(t,{class:"status-text"},{default:c(()=>[p(y(O.value),1)]),_:1})]),_:1},8,["class"]),w(t,{class:"pressure-range"},{default:c(()=>[w(t,{class:"range-bar"},{default:c(()=>[w(t,{class:"range-section safe"}),w(t,{class:"range-section warning"}),w(t,{class:"range-section danger"})]),_:1}),w(t,{class:"range-indicator",style:M(q.value)},null,8,["style"])]),_:1})]),_:1}),w(t,{class:"wear-info-section"},{default:c(()=>[_("h2",{class:"section-title"},"佩戴信息"),w(t,{class:"info-cards"},{default:c(()=>[w(t,{class:"info-card"},{default:c(()=>[w(t,{class:"card-label"},{default:c(()=>[p("佩戴状态")]),_:1}),w(t,{class:x(["card-value",R.value])},{default:c(()=>[p(y(z.value),1)]),_:1},8,["class"])]),_:1}),w(t,{class:"info-card"},{default:c(()=>[w(t,{class:"card-label"},{default:c(()=>[p("电池电量")]),_:1}),w(t,{class:"card-value battery"},{default:c(()=>[w(t,{class:"battery-icon"},{default:c(()=>[w(t,{class:"battery-fill",style:M(N.value)},null,8,["style"])]),_:1}),w(t,{class:"battery-percent"},{default:c(()=>[p(y($.value)+"%",1)]),_:1})]),_:1})]),_:1}),w(t,{class:"info-card"},{default:c(()=>[w(t,{class:"card-label"},{default:c(()=>[p("今日佩戴")]),_:1}),w(t,{class:"card-value"},{default:c(()=>[p(y(A.value),1)]),_:1})]),_:1}),w(t,{class:"info-card"},{default:c(()=>[w(t,{class:"card-label"},{default:c(()=>[p("压力平均值")]),_:1}),w(t,{class:"card-value"},{default:c(()=>[p(y(L.value)+" kPa",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-85803938"]]);export{D as default};
