import{d as e,r as a,l as s,m as t,p as r,q as l,c as i,w as u,i as o,o as n,a as c,e as d,t as v,v as m,y as h,x as p,j as f,F as w,k as _}from"./index-BRh_6ZeJ.js";import b from"..-node_modules-@qiun-ucharts-u-charts.Bc6tG3QR.js";import{a as g}from"./data-utils.CvkuW9cv.js";import{W as x}from"./config.CnoCz8Wu.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=y(e({__name:"daily-detail",setup(e){const y=a(s("currentPatient")||{name:"未知患者"}),P=a(s("currentDailyData")||{date:"2023-12-01",wearTime:0,minPressure:0,maxPressure:0,avgPressure:0,status:"normal"}),T=a([]),S=a(null),F=e=>{switch(e){case"normal":return"达标";case"abnormal":return"异常未佩戴";case"reasonable":return"合理未佩戴";default:return"未知"}};t(async()=>{const e=g(P.value.date);T.value=j(e),setTimeout(async()=>{await L()},100)});const j=e=>{const a=[];for(let s=0;s<24;s++)a[s]={hour:s,status:"normal",pressure:0};return e.forEach(e=>{const s=e.hour;a[s]||(a[s]={hour:s,status:"normal",pressure:0,count:0}),e.worn&&(a[s].totalPressure||(a[s].totalPressure=0),a[s].count||(a[s].count=0),a[s].totalPressure+=e.pressure,a[s].count++,a[s].pressure=a[s].count>0?a[s].totalPressure/a[s].count:0),e.hour>=x.bathTimeStart&&e.hour<x.bathTimeEnd?a[s].status="reasonable":e.worn||(a[s].status="abnormal")}),a},k=e=>e>=x.bathTimeStart&&e<x.bathTimeEnd?"bath-time":"",C=e=>{const a=T.value[e];return a?a.status:"normal"},E=e=>{const a=T.value[e];return a?e>=x.bathTimeStart&&e<x.bathTimeEnd?"合理未佩戴":"normal"===a.status?"正常佩戴":"异常未佩戴":"未知"},L=async()=>{const e={categories:T.value.map(e=>e.hour.toString()),series:[{name:"压力值",data:T.value.map(e=>e.pressure),color:"#1890ff"}]},a=await new Promise(e=>{r().select("#pressureChart").fields({node:!0,size:!0}).exec(a=>{e(a[0].node)})}),s=a.getContext("2d"),{width:t,height:i}=a;new b({context:s,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:l().pixelRatio,categories:e.categories,series:e.series,animation:!0,xAxis:{disableGrid:!0,axisLine:!0,axisLabel:!0,itemCount:12},yAxis:{gridType:"dash",dashLength:2,splitNumber:5,min:0,max:250},width:t,height:i,extra:{line:{type:"straight",width:2,activeType:"hollow",animation:!0}}})};return(e,a)=>{const s=o,t=p;return n(),i(s,{class:"daily-detail-page"},{default:u(()=>[c(s,{class:"page-header"},{default:u(()=>[c(s,{class:"patient-date-info"},{default:u(()=>[c(s,{class:"patient-name"},{default:u(()=>[d(v(y.value.name),1)]),_:1}),c(s,{class:"detail-date"},{default:u(()=>[d(v(P.value.date),1)]),_:1})]),_:1})]),_:1}),c(s,{class:"overview-section"},{default:u(()=>[c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"总佩戴时长"),m("div",{class:"overview-value"},[d(v(P.value.wearTime),1),m("span",{class:"unit"},"小时")])]),_:1}),c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"压力范围"),m("div",{class:"overview-value"},[d(v(P.value.minPressure)+"-"+v(P.value.maxPressure),1),m("span",{class:"unit"},"kPa")])]),_:1}),c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"平均压力"),m("div",{class:"overview-value"},[d(v(P.value.avgPressure),1),m("span",{class:"unit"},"kPa")])]),_:1}),c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"今日状态"),m("div",{class:h(["overview-value status",P.value.status])},v(F(P.value.status)),3)]),_:1})]),_:1}),c(s,{class:"pressure-chart-section"},{default:u(()=>[c(s,{class:"section-title"},{default:u(()=>[d("压力值变化曲线")]),_:1}),c(t,{ref_key:"pressureChartRef",ref:S,id:"pressureChart",class:"pressure-chart"},null,512)]),_:1}),c(s,{class:"hourly-list-section"},{default:u(()=>[c(s,{class:"section-title"},{default:u(()=>[d("24小时佩戴状态")]),_:1}),c(s,{class:"hourly-list"},{default:u(()=>[(n(),f(w,null,_(24,e=>c(s,{key:e,class:h(["hourly-item",k(e)])},{default:u(()=>[m("div",{class:"hour-time"},v(e.toString().padStart(2,"0"))+":00",1),m("div",{class:h(["hour-status",C(e)])},v(E(e)),3)]),_:2},1032,["class"])),64))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-25ed8d43"]]);export{P as default};
