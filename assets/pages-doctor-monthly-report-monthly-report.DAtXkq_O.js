import{d as a,r as e,l as t,g as s,m as l,W as i,p as d,q as n,c,w as r,i as u,o,a as m,e as v,t as h,v as p,x as f,j as y,F as _,k as g,y as x,s as b,n as w}from"./index-BEpFFJ6X.js";import F from"..-node_modules-@qiun-ucharts-u-charts.Bc6tG3QR.js";import{g as C}from"./data-utils.Byn_eUs6.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=T(a({__name:"monthly-report",setup(a){const T=e(t("currentPatient")||{name:"未知患者",deviceId:"未知设备"}),k=e((new Date).getMonth()+1),P=e((new Date).getFullYear()),j=e([]),D=e(null),I=s(()=>j.value.reduce((a,e)=>a+e.wearTime,0).toFixed(1)),L=s(()=>j.value.filter(a=>"normal"===a.status).length),R=s(()=>0===j.value.length?0:Math.round(L.value/j.value.length*100)),q=a=>{switch(a){case"normal":return"达标";case"abnormal":return"异常未佩戴";case"reasonable":return"合理未佩戴";default:return"未知"}};l(()=>{j.value=C(P.value,k.value),setTimeout(async()=>{await z()},100)});const z=async()=>{const a={categories:j.value.map(a=>a.date.split("-")[2]),series:[{name:"佩戴时长",data:j.value.map(a=>a.wearTime),color:"#1890ff"},{name:"达标线",data:j.value.map(()=>i.targetTime),color:"#52c41a",lineType:"dash"}]},e=await new Promise(a=>{d().select("#monthlyChart").fields({node:!0,size:!0}).exec(e=>{a(e[0].node)})}),t=e.getContext("2d"),{width:s,height:l}=e;new F({context:t,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:n().pixelRatio,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,axisLine:!0,axisLabel:!0,itemCount:10},yAxis:{gridType:"dash",dashLength:2,splitNumber:5,min:0,max:24},width:s,height:l,extra:{line:{type:"straight",width:2,activeType:"hollow",animation:!0}}})};return(a,e)=>{const t=u,s=f;return o(),c(t,{class:"monthly-report-page"},{default:r(()=>[m(t,{class:"page-header"},{default:r(()=>[m(t,{class:"patient-info-card"},{default:r(()=>[m(t,{class:"patient-name"},{default:r(()=>[v(h(T.value.name),1)]),_:1}),m(t,{class:"patient-device"},{default:r(()=>[v("设备ID: "+h(T.value.deviceId),1)]),_:1})]),_:1})]),_:1}),m(t,{class:"statistics-section"},{default:r(()=>[m(t,{class:"stat-card"},{default:r(()=>[p("div",{class:"stat-label"},"本月总时长"),p("div",{class:"stat-value"},[v(h(I.value),1),p("span",{class:"unit"},"小时")])]),_:1}),m(t,{class:"stat-card"},{default:r(()=>[p("div",{class:"stat-label"},"达标天数"),p("div",{class:"stat-value"},[v(h(L.value),1),p("span",{class:"unit"},"天")])]),_:1}),m(t,{class:"stat-card"},{default:r(()=>[p("div",{class:"stat-label"},"达标率"),p("div",{class:"stat-value"},h(R.value)+"%",1)]),_:1})]),_:1}),m(t,{class:"chart-section"},{default:r(()=>[m(t,{class:"chart-title"},{default:r(()=>[v("每日佩戴时长趋势")]),_:1}),m(s,{ref_key:"monthlyChartRef",ref:D,"canvas-id":"monthlyChart",id:"monthlyChart",class:"monthly-chart"},null,512)]),_:1}),m(t,{class:"daily-list-section"},{default:r(()=>[m(t,{class:"section-title"},{default:r(()=>[v("每日数据列表")]),_:1}),m(t,{class:"daily-list"},{default:r(()=>[(o(!0),y(_,null,g(j.value,(a,e)=>(o(),c(t,{key:e,class:"daily-item",onClick:e=>(a=>{b("currentDailyData",a),w({url:"/pages/doctor/daily-detail/daily-detail"})})(a)},{default:r(()=>[p("div",{class:"day-info"},[p("div",{class:"day-date"},h(a.date),1),p("div",{class:x(["day-status",a.status])},h(q(a.status)),3)]),p("div",{class:"day-data"},[p("div",{class:"data-item"},[p("div",{class:"data-label"},"佩戴时长"),p("div",{class:"data-value"},h(a.wearTime)+"小时",1)]),p("div",{class:"data-item"},[p("div",{class:"data-label"},"压力范围"),p("div",{class:"data-value"},h(a.minPressure)+"-"+h(a.maxPressure)+"kPa",1)])])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-9cbdbc52"]]);export{k as default};
