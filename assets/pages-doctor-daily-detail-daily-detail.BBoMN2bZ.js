import{d as a,r as e,l as s,m as t,p as r,q as l,c as i,w as u,i as o,o as n,a as c,e as d,t as v,u as m,x as h,v as p,j as f,F as w,k as _}from"./index-BwvTMwSV.js";import{a as b}from"./data-utils.CJS2CjW6.js";import g from"./assets/static/qiun-ucharts/u-charts.min.js";import{W as x}from"./config.CnoCz8Wu.js";import{_ as y}from"./plugin-vueexport-helper.BCo6x5W8.js";const P=y(a({__name:"daily-detail",setup(a){const y=e(s("currentPatient")||{name:"未知患者"}),P=e(s("currentDailyData")||{date:"2023-12-01",wearTime:0,minPressure:0,maxPressure:0,avgPressure:0,status:"normal"}),T=e([]),S=e(null),F=a=>{switch(a){case"normal":return"达标";case"abnormal":return"异常未佩戴";case"reasonable":return"合理未佩戴";default:return"未知"}};t(async()=>{const a=b(P.value.date);T.value=j(a),setTimeout(async()=>{await L()},100)});const j=a=>{const e=[];for(let s=0;s<24;s++)e[s]={hour:s,status:"normal",pressure:0};return a.forEach(a=>{const s=a.hour;e[s]||(e[s]={hour:s,status:"normal",pressure:0,count:0}),a.worn&&(e[s].totalPressure||(e[s].totalPressure=0),e[s].count||(e[s].count=0),e[s].totalPressure+=a.pressure,e[s].count++,e[s].pressure=e[s].count>0?e[s].totalPressure/e[s].count:0),a.hour>=x.bathTimeStart&&a.hour<x.bathTimeEnd?e[s].status="reasonable":a.worn||(e[s].status="abnormal")}),e},k=a=>a>=x.bathTimeStart&&a<x.bathTimeEnd?"bath-time":"",C=a=>{const e=T.value[a];return e?e.status:"normal"},E=a=>{const e=T.value[a];return e?a>=x.bathTimeStart&&a<x.bathTimeEnd?"合理未佩戴":"normal"===e.status?"正常佩戴":"异常未佩戴":"未知"},L=async()=>{const a={categories:T.value.map(a=>a.hour.toString()),series:[{name:"压力值",data:T.value.map(a=>a.pressure),color:"#1890ff"}]},e=await new Promise(a=>{r().select("#pressureChart").fields({node:!0,size:!0}).exec(e=>{a(e[0].node)})}),s=e.getContext("2d"),{width:t,height:i}=e;new g({context:s,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:l().pixelRatio,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,axisLine:!0,axisLabel:!0,itemCount:12},yAxis:{gridType:"dash",dashLength:2,splitNumber:5,min:0,max:250},width:t,height:i,extra:{line:{type:"straight",width:2,activeType:"hollow",animation:!0}}})};return(a,e)=>{const s=o,t=p;return n(),i(s,{class:"daily-detail-page"},{default:u(()=>[c(s,{class:"page-header"},{default:u(()=>[c(s,{class:"patient-date-info"},{default:u(()=>[c(s,{class:"patient-name"},{default:u(()=>[d(v(y.value.name),1)]),_:1}),c(s,{class:"detail-date"},{default:u(()=>[d(v(P.value.date),1)]),_:1})]),_:1})]),_:1}),c(s,{class:"overview-section"},{default:u(()=>[c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"总佩戴时长"),m("div",{class:"overview-value"},[d(v(P.value.wearTime),1),m("span",{class:"unit"},"小时")])]),_:1}),c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"压力范围"),m("div",{class:"overview-value"},[d(v(P.value.minPressure)+"-"+v(P.value.maxPressure),1),m("span",{class:"unit"},"kPa")])]),_:1}),c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"平均压力"),m("div",{class:"overview-value"},[d(v(P.value.avgPressure),1),m("span",{class:"unit"},"kPa")])]),_:1}),c(s,{class:"overview-card"},{default:u(()=>[m("div",{class:"overview-label"},"今日状态"),m("div",{class:h(["overview-value status",P.value.status])},v(F(P.value.status)),3)]),_:1})]),_:1}),c(s,{class:"pressure-chart-section"},{default:u(()=>[c(s,{class:"section-title"},{default:u(()=>[d("压力值变化曲线")]),_:1}),c(t,{ref_key:"pressureChartRef",ref:S,id:"pressureChart",class:"pressure-chart"},null,512)]),_:1}),c(s,{class:"hourly-list-section"},{default:u(()=>[c(s,{class:"section-title"},{default:u(()=>[d("24小时佩戴状态")]),_:1}),c(s,{class:"hourly-list"},{default:u(()=>[(n(),f(w,null,_(24,a=>c(s,{key:a,class:h(["hourly-item",k(a)])},{default:u(()=>[m("div",{class:"hour-time"},v(a.toString().padStart(2,"0"))+":00",1),m("div",{class:h(["hour-status",C(a)])},v(E(a)),3)]),_:2},1032,["class"])),64))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-24655386"]]);export{P as default};
