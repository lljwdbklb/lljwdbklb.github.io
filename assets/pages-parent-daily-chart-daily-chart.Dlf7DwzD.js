import{d as e,r as a,m as t,E as s,c as l,w as r,p as o,q as i,i as c,o as n,a as d,e as u,u as h,t as f,S as g,v as m,j as v,F as p,k as x,x as w}from"./index-QjOnPgAD.js";import _ from"assets/qiun-ucharts/u-charts.min.js";import{a as b}from"./data-utils.CJS2CjW6.js";import{W as y}from"./config.CnoCz8Wu.js";import{_ as T}from"./plugin-vueexport-helper.BCo6x5W8.js";const M=T(e({__name:"daily-chart",setup(e){const T=a([]),M=a("00:00"),S=a(0),F=a("00:00"),L=a(0),C=a(null),k=a(null);let P=null,j=null;const D=e=>{const a={categories:e.map(e=>e.dateLabel),series:[{name:"佩戴时长",data:e.map(e=>e.wearTimeMinutes/60),color:"#1890ff"},{name:"目标时长",data:e.map(()=>y.targetTime),color:"#ff4d4f",type:"line"}]},t=80*e.length+100,s=o();s.select("#wearTimeChart").fields({node:!0,size:!0}),s.exec(e=>{if(e&&e[0]&&e[0].node){const l=e[0].node,r=l.getContext("2d",{alpha:!0});if(i(),!r)return void console.error("无法获取佩戴时长图表的canvas上下文");e[0].width;const o=e[0].height,c=300,n=200,d=Math.max(t,c),u=Math.max(o||0,n);l.width=d,l.height=u;try{const e={context:r,canvas:l,width:d,height:u,type:"column",fontSize:12,legend:!0,dataLabel:!0,dataPointShape:!0,background:"#FFFFFF",pixelRatio:1,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,rotateLabel:30},yAxis:{gridType:"dash",dashLength:2,splitNumber:5},extra:{column:{width:12},line:{type:"straight",width:2}}};if(!e)return void console.error("佩戴时长图表options为空");console.log("佩戴时长图表初始化参数:",e),P=new _(e),console.log("佩戴时长图表初始化成功，尺寸：",d,"x",u)}catch(s){console.error("佩戴时长图表初始化失败:",s)}}else console.error("无法获取佩戴时长图表的canvas元素",e)})},z=e=>{const a={categories:e.map(e=>e.dateLabel),series:[{name:"平均压力",data:e.map(e=>e.avgPressure),color:"#52c41a"}]};e.length;const t=o();t.select("#pressureChart").fields({node:!0,size:!0}),t.exec(e=>{if(e&&e[0]&&e[0].node){const s=e[0].node,l=s.getContext("2d",{alpha:!0});if(i(),!l)return void console.error("无法获取压力趋势图表的canvas上下文");e[0].width;const r=e[0].height,o=200,c=600,n=Math.max(r||0,o);s.width=c,s.height=n;try{const e={context:l,canvas:s,width:c,height:n,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:1,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,rotateLabel:30},yAxis:{gridType:"dash",dashLength:2,splitNumber:5},extra:{line:{type:"straight",width:1.5},point:{size:3}}};if(!e)return void console.error("压力趋势图表options为空");console.log("压力趋势图表初始化参数:",e),j=new _(e),console.log("压力趋势图表初始化成功，尺寸：",c,"x",n)}catch(t){console.error("压力趋势图表初始化失败:",t)}}else console.error("无法获取压力趋势图表的canvas元素",e)})};return t(()=>{const e=(()=>{const e=[],a=new Date;for(let c=6;c>=0;c--){const t=new Date(a);t.setDate(t.getDate()-c);const s=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0"),l=b(s),r=l.filter(e=>e.worn).length,o=l.filter(e=>e.worn).reduce((e,a)=>e+a.pressure,0),i=30*r,n=r>0?Math.round(o/r):0,d=Math.floor(i/60),u=i%60,h=`${String(d).padStart(2,"0")}:${String(u).padStart(2,"0")}`;let f="abnormal",g="未达标";d>=y.targetTime&&(f="normal",g="已达标"),e.push({date:s,dateLabel:String(t.getMonth()+1)+"/"+String(t.getDate()),wearTime:h,wearTimeMinutes:i,avgPressure:n,status:f,statusText:g})}T.value=e;const t=e.reduce((e,a)=>e+a.wearTimeMinutes,0),s=e.length,l=Math.round(t/s),r=e.filter(e=>"normal"===e.status).length,o=Math.floor(l/60);M.value=`${o}小时`,S.value=Math.round(r/s*100);const i=Math.floor(t/60);return F.value=`${i}小时`,L.value=Math.round(e.reduce((e,a)=>e+a.avgPressure,0)/s),e})();console.log("生成的数据:",e),setTimeout(()=>{try{D(e),z(e)}catch(a){console.error("图表初始化失败:",a)}},300)}),s(()=>{setTimeout(()=>{T.value.length>0&&(D(T.value),z(T.value))},100)}),(e,a)=>{const t=c,s=m,o=g;return n(),l(t,{class:"daily-chart-page"},{default:r(()=>[d(t,{class:"page-header"},{default:r(()=>[d(t,{class:"date-range"},{default:r(()=>[d(t,{class:"range-text"},{default:r(()=>[u("最近7天")]),_:1})]),_:1})]),_:1}),d(t,{class:"stats-overview"},{default:r(()=>[d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},f(M.value),1),h("div",{class:"stat-label"},"平均佩戴时长")]),_:1}),d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},f(S.value)+"%",1),h("div",{class:"stat-label"},"每日达标率")]),_:1}),d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},f(F.value),1),h("div",{class:"stat-label"},"总佩戴时长")]),_:1}),d(t,{class:"stat-card"},{default:r(()=>[h("div",{class:"stat-value"},f(L.value),1),h("div",{class:"stat-label"},"平均压力值")]),_:1})]),_:1}),d(t,{class:"charts-section"},{default:r(()=>[d(t,{class:"chart-card"},{default:r(()=>[h("h2",{class:"chart-title"},"每日佩戴时长"),d(o,{class:"chart-container","scroll-x":"true","enable-flex":"true","show-scrollbar":"false"},{default:r(()=>[d(s,{ref_key:"wearTimeChartRef",ref:C,id:"wearTimeChart",class:"chart"},null,512)]),_:1})]),_:1}),d(t,{class:"chart-card"},{default:r(()=>[h("h2",{class:"chart-title"},"每日压力趋势"),d(o,{class:"chart-container","scroll-x":"true","enable-flex":"true","show-scrollbar":"false"},{default:r(()=>[d(s,{ref_key:"pressureChartRef",ref:k,id:"pressureChart",class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),d(t,{class:"daily-list"},{default:r(()=>[h("h2",{class:"section-title"},"每日详情"),d(t,{class:"list-items"},{default:r(()=>[(n(!0),v(p,null,x(T.value,e=>(n(),l(t,{key:e.date,class:w(["list-item",e.status])},{default:r(()=>[d(t,{class:"item-left"},{default:r(()=>[h("div",{class:"item-date"},f(e.date),1),h("div",{class:"item-status"},f(e.statusText),1)]),_:2},1024),d(t,{class:"item-right"},{default:r(()=>[h("div",{class:"item-time"},f(e.wearTime),1),h("div",{class:"item-pressure"},f(e.avgPressure)+"kPa",1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-f100649a"]]);export{M as default};
