import{d as a,r as e,m as t,h as s,p as l,q as i,u as d,c as n,w as c,i as r,o as u,a as o,e as m,t as v,v as h,x as p,k as f,F as y,l as g,y as _,g as x,n as w}from"./index-p-adsUdp.js";import b from"./u-charts.min.js";import{g as F}from"./data-utils.CYepGN39.js";import{W as C}from"./config.BYcWPge6.js";import{_ as T}from"./plugin-vueexport-helper.BCo6x5W8.js";const k=T(a({__name:"monthly-report",setup(a){const T=e(t("currentPatient")||{name:"未知患者",deviceId:"未知设备"}),k=e((new Date).getMonth()+1),P=e((new Date).getFullYear()),j=e([]),D=e(null),I=s(()=>j.value.reduce((a,e)=>a+e.wearTime,0).toFixed(1)),L=s(()=>j.value.filter(a=>"normal"===a.status).length),R=s(()=>0===j.value.length?0:Math.round(L.value/j.value.length*100)),z=a=>{switch(a){case"normal":return"达标";case"abnormal":return"异常未佩戴";case"reasonable":return"合理未佩戴";default:return"未知"}};l(()=>{j.value=F(P.value,k.value),setTimeout(async()=>{await A()},100)});const A=async()=>{const a={categories:j.value.map(a=>a.date.split("-")[2]),series:[{name:"佩戴时长",data:j.value.map(a=>a.wearTime),color:"#1890ff"},{name:"达标线",data:j.value.map(()=>C.targetTime),color:"#52c41a",lineType:"dash"}]},e=await new Promise(a=>{i().select("#monthlyChart").fields({node:!0,size:!0}).exec(e=>{a(e[0].node)})}),t=e.getContext("2d"),{width:s,height:l}=e;new b({context:t,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:d().pixelRatio,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,axisLine:!0,axisLabel:!0,itemCount:10},yAxis:{gridType:"dash",dashLength:2,splitNumber:5,min:0,max:24},width:s,height:l,extra:{line:{type:"straight",width:2,activeType:"hollow",animation:!0}}})};return(a,e)=>{const t=r,s=p;return u(),n(t,{class:"monthly-report-page"},{default:c(()=>[o(t,{class:"page-header"},{default:c(()=>[o(t,{class:"patient-info-card"},{default:c(()=>[o(t,{class:"patient-name"},{default:c(()=>[m(v(T.value.name),1)]),_:1}),o(t,{class:"patient-device"},{default:c(()=>[m("设备ID: "+v(T.value.deviceId),1)]),_:1})]),_:1})]),_:1}),o(t,{class:"statistics-section"},{default:c(()=>[o(t,{class:"stat-card"},{default:c(()=>[h("div",{class:"stat-label"},"本月总时长"),h("div",{class:"stat-value"},[m(v(I.value),1),h("span",{class:"unit"},"小时")])]),_:1}),o(t,{class:"stat-card"},{default:c(()=>[h("div",{class:"stat-label"},"达标天数"),h("div",{class:"stat-value"},[m(v(L.value),1),h("span",{class:"unit"},"天")])]),_:1}),o(t,{class:"stat-card"},{default:c(()=>[h("div",{class:"stat-label"},"达标率"),h("div",{class:"stat-value"},v(R.value)+"%",1)]),_:1})]),_:1}),o(t,{class:"chart-section"},{default:c(()=>[o(t,{class:"chart-title"},{default:c(()=>[m("每日佩戴时长趋势")]),_:1}),o(s,{ref_key:"monthlyChartRef",ref:D,"canvas-id":"monthlyChart",id:"monthlyChart",class:"monthly-chart"},null,512)]),_:1}),o(t,{class:"daily-list-section"},{default:c(()=>[o(t,{class:"section-title"},{default:c(()=>[m("每日数据列表")]),_:1}),o(t,{class:"daily-list"},{default:c(()=>[(u(!0),f(y,null,g(j.value,(a,e)=>(u(),n(t,{key:e,class:"daily-item",onClick:e=>(a=>{x("currentDailyData",a),w({url:"/pages/doctor/daily-detail/daily-detail"})})(a)},{default:c(()=>[h("div",{class:"day-info"},[h("div",{class:"day-date"},v(a.date),1),h("div",{class:_(["day-status",a.status])},v(z(a.status)),3)]),h("div",{class:"day-data"},[h("div",{class:"data-item"},[h("div",{class:"data-label"},"佩戴时长"),h("div",{class:"data-value"},v(a.wearTime)+"小时",1)]),h("div",{class:"data-item"},[h("div",{class:"data-label"},"压力范围"),h("div",{class:"data-value"},v(a.minPressure)+"-"+v(a.maxPressure)+"kPa",1)])])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-9cbdbc52"]]);export{k as default};
