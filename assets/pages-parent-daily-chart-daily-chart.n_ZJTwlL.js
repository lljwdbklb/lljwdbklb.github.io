import{d as e,r as a,m as t,G as s,c as l,w as r,W as o,p as i,q as c,i as n,o as d,a as u,e as h,v as g,t as f,S as m,x as v,j as p,F as x,k as _,y as w}from"./index-BEpFFJ6X.js";import b from"..-node_modules-@qiun-ucharts-u-charts.Bc6tG3QR.js";import{a as y}from"./data-utils.Byn_eUs6.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=T(e({__name:"daily-chart",setup(e){const T=a([]),M=a("00:00"),S=a(0),F=a("00:00"),L=a(0),C=a(null),k=a(null);let P=null,D=null;const j=e=>{const a={categories:e.map(e=>e.dateLabel),series:[{name:"佩戴时长",data:e.map(e=>e.wearTimeMinutes/60),color:"#1890ff"},{name:"目标时长",data:e.map(()=>o.targetTime),color:"#ff4d4f",type:"line"}]},t=80*e.length+100,s=i();s.select("#wearTimeChart").fields({node:!0,size:!0}),s.exec(e=>{if(e&&e[0]&&e[0].node){const l=e[0].node,r=l.getContext("2d",{alpha:!0});if(c(),!r)return void console.error("无法获取佩戴时长图表的canvas上下文");e[0].width;const o=e[0].height,i=300,n=200,d=Math.max(t,i),u=Math.max(o||0,n);l.width=d,l.height=u;try{const e={context:r,canvas:l,width:d,height:u,type:"column",fontSize:12,legend:!0,dataLabel:!0,dataPointShape:!0,background:"#FFFFFF",pixelRatio:1,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,rotateLabel:30},yAxis:{gridType:"dash",dashLength:2,splitNumber:5},extra:{column:{width:12},line:{type:"straight",width:2}}};if(!e)return void console.error("佩戴时长图表options为空");console.log("佩戴时长图表初始化参数:",e),P=new b(e),console.log("佩戴时长图表初始化成功，尺寸：",d,"x",u)}catch(s){console.error("佩戴时长图表初始化失败:",s)}}else console.error("无法获取佩戴时长图表的canvas元素",e)})},z=e=>{const a={categories:e.map(e=>e.dateLabel),series:[{name:"平均压力",data:e.map(e=>e.avgPressure),color:"#52c41a"}]};e.length;const t=i();t.select("#pressureChart").fields({node:!0,size:!0}),t.exec(e=>{if(e&&e[0]&&e[0].node){const s=e[0].node,l=s.getContext("2d",{alpha:!0});if(c(),!l)return void console.error("无法获取压力趋势图表的canvas上下文");e[0].width;const r=e[0].height,o=200,i=600,n=Math.max(r||0,o);s.width=i,s.height=n;try{const e={context:l,canvas:s,width:i,height:n,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:1,categories:a.categories,series:a.series,animation:!0,xAxis:{disableGrid:!0,rotateLabel:30},yAxis:{gridType:"dash",dashLength:2,splitNumber:5},extra:{line:{type:"straight",width:1.5},point:{size:3}}};if(!e)return void console.error("压力趋势图表options为空");console.log("压力趋势图表初始化参数:",e),D=new b(e),console.log("压力趋势图表初始化成功，尺寸：",i,"x",n)}catch(t){console.error("压力趋势图表初始化失败:",t)}}else console.error("无法获取压力趋势图表的canvas元素",e)})};return t(()=>{const e=(()=>{const e=[],a=new Date;for(let n=6;n>=0;n--){const t=new Date(a);t.setDate(t.getDate()-n);const s=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0"),l=y(s),r=l.filter(e=>e.worn).length,i=l.filter(e=>e.worn).reduce((e,a)=>e+a.pressure,0),c=30*r,d=r>0?Math.round(i/r):0,u=Math.floor(c/60),h=c%60,g=`${String(u).padStart(2,"0")}:${String(h).padStart(2,"0")}`;let f="abnormal",m="未达标";u>=o.targetTime&&(f="normal",m="已达标"),e.push({date:s,dateLabel:String(t.getMonth()+1)+"/"+String(t.getDate()),wearTime:g,wearTimeMinutes:c,avgPressure:d,status:f,statusText:m})}T.value=e;const t=e.reduce((e,a)=>e+a.wearTimeMinutes,0),s=e.length,l=Math.round(t/s),r=e.filter(e=>"normal"===e.status).length,i=Math.floor(l/60);M.value=`${i}小时`,S.value=Math.round(r/s*100);const c=Math.floor(t/60);return F.value=`${c}小时`,L.value=Math.round(e.reduce((e,a)=>e+a.avgPressure,0)/s),e})();console.log("生成的数据:",e),setTimeout(()=>{try{j(e),z(e)}catch(a){console.error("图表初始化失败:",a)}},300)}),s(()=>{setTimeout(()=>{T.value.length>0&&(j(T.value),z(T.value))},100)}),(e,a)=>{const t=n,s=v,o=m;return d(),l(t,{class:"daily-chart-page"},{default:r(()=>[u(t,{class:"page-header"},{default:r(()=>[u(t,{class:"date-range"},{default:r(()=>[u(t,{class:"range-text"},{default:r(()=>[h("最近7天")]),_:1})]),_:1})]),_:1}),u(t,{class:"stats-overview"},{default:r(()=>[u(t,{class:"stat-card"},{default:r(()=>[g("div",{class:"stat-value"},f(M.value),1),g("div",{class:"stat-label"},"平均佩戴时长")]),_:1}),u(t,{class:"stat-card"},{default:r(()=>[g("div",{class:"stat-value"},f(S.value)+"%",1),g("div",{class:"stat-label"},"每日达标率")]),_:1}),u(t,{class:"stat-card"},{default:r(()=>[g("div",{class:"stat-value"},f(F.value),1),g("div",{class:"stat-label"},"总佩戴时长")]),_:1}),u(t,{class:"stat-card"},{default:r(()=>[g("div",{class:"stat-value"},f(L.value),1),g("div",{class:"stat-label"},"平均压力值")]),_:1})]),_:1}),u(t,{class:"charts-section"},{default:r(()=>[u(t,{class:"chart-card"},{default:r(()=>[g("h2",{class:"chart-title"},"每日佩戴时长"),u(o,{class:"chart-container","scroll-x":"true","enable-flex":"true","show-scrollbar":"false"},{default:r(()=>[u(s,{ref_key:"wearTimeChartRef",ref:C,id:"wearTimeChart",class:"chart"},null,512)]),_:1})]),_:1}),u(t,{class:"chart-card"},{default:r(()=>[g("h2",{class:"chart-title"},"每日压力趋势"),u(o,{class:"chart-container","scroll-x":"true","enable-flex":"true","show-scrollbar":"false"},{default:r(()=>[u(s,{ref_key:"pressureChartRef",ref:k,id:"pressureChart",class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),u(t,{class:"daily-list"},{default:r(()=>[g("h2",{class:"section-title"},"每日详情"),u(t,{class:"list-items"},{default:r(()=>[(d(!0),p(x,null,_(T.value,e=>(d(),l(t,{key:e.date,class:w(["list-item",e.status])},{default:r(()=>[u(t,{class:"item-left"},{default:r(()=>[g("div",{class:"item-date"},f(e.date),1),g("div",{class:"item-status"},f(e.statusText),1)]),_:2},1024),u(t,{class:"item-right"},{default:r(()=>[g("div",{class:"item-time"},f(e.wearTime),1),g("div",{class:"item-pressure"},f(e.avgPressure)+"kPa",1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-f100649a"]]);export{M as default};
