import{d as e,r as a,l as s,m as t,W as r,p as l,q as i,c as u,w as o,i as n,o as c,a as d,e as v,t as m,v as h,y as p,x as f,j as w,F as _,k as b}from"./index-BEpFFJ6X.js";import g from"..-node_modules-@qiun-ucharts-u-charts.Bc6tG3QR.js";import{a as x}from"./data-utils.Byn_eUs6.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=y(e({__name:"daily-detail",setup(e){const y=a(s("currentPatient")||{name:"未知患者"}),P=a(s("currentDailyData")||{date:"2023-12-01",wearTime:0,minPressure:0,maxPressure:0,avgPressure:0,status:"normal"}),T=a([]),S=a(null),F=e=>{switch(e){case"normal":return"达标";case"abnormal":return"异常未佩戴";case"reasonable":return"合理未佩戴";default:return"未知"}};t(async()=>{const e=x(P.value.date);T.value=k(e),setTimeout(async()=>{await L()},100)});const k=e=>{const a=[];for(let s=0;s<24;s++)a[s]={hour:s,status:"normal",pressure:0};return e.forEach(e=>{const s=e.hour;a[s]||(a[s]={hour:s,status:"normal",pressure:0,count:0}),e.worn&&(a[s].totalPressure||(a[s].totalPressure=0),a[s].count||(a[s].count=0),a[s].totalPressure+=e.pressure,a[s].count++,a[s].pressure=a[s].count>0?a[s].totalPressure/a[s].count:0),e.hour>=r.bathTimeStart&&e.hour<r.bathTimeEnd?a[s].status="reasonable":e.worn||(a[s].status="abnormal")}),a},j=e=>e>=r.bathTimeStart&&e<r.bathTimeEnd?"bath-time":"",C=e=>{const a=T.value[e];return a?a.status:"normal"},E=e=>{const a=T.value[e];return a?e>=r.bathTimeStart&&e<r.bathTimeEnd?"合理未佩戴":"normal"===a.status?"正常佩戴":"异常未佩戴":"未知"},L=async()=>{const e={categories:T.value.map(e=>e.hour.toString()),series:[{name:"压力值",data:T.value.map(e=>e.pressure),color:"#1890ff"}]},a=await new Promise(e=>{l().select("#pressureChart").fields({node:!0,size:!0}).exec(a=>{e(a[0].node)})}),s=a.getContext("2d"),{width:t,height:r}=a;new g({context:s,type:"line",fontSize:12,legend:!0,dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:i().pixelRatio,categories:e.categories,series:e.series,animation:!0,xAxis:{disableGrid:!0,axisLine:!0,axisLabel:!0,itemCount:12},yAxis:{gridType:"dash",dashLength:2,splitNumber:5,min:0,max:250},width:t,height:r,extra:{line:{type:"straight",width:2,activeType:"hollow",animation:!0}}})};return(e,a)=>{const s=n,t=f;return c(),u(s,{class:"daily-detail-page"},{default:o(()=>[d(s,{class:"page-header"},{default:o(()=>[d(s,{class:"patient-date-info"},{default:o(()=>[d(s,{class:"patient-name"},{default:o(()=>[v(m(y.value.name),1)]),_:1}),d(s,{class:"detail-date"},{default:o(()=>[v(m(P.value.date),1)]),_:1})]),_:1})]),_:1}),d(s,{class:"overview-section"},{default:o(()=>[d(s,{class:"overview-card"},{default:o(()=>[h("div",{class:"overview-label"},"总佩戴时长"),h("div",{class:"overview-value"},[v(m(P.value.wearTime),1),h("span",{class:"unit"},"小时")])]),_:1}),d(s,{class:"overview-card"},{default:o(()=>[h("div",{class:"overview-label"},"压力范围"),h("div",{class:"overview-value"},[v(m(P.value.minPressure)+"-"+m(P.value.maxPressure),1),h("span",{class:"unit"},"kPa")])]),_:1}),d(s,{class:"overview-card"},{default:o(()=>[h("div",{class:"overview-label"},"平均压力"),h("div",{class:"overview-value"},[v(m(P.value.avgPressure),1),h("span",{class:"unit"},"kPa")])]),_:1}),d(s,{class:"overview-card"},{default:o(()=>[h("div",{class:"overview-label"},"今日状态"),h("div",{class:p(["overview-value status",P.value.status])},m(F(P.value.status)),3)]),_:1})]),_:1}),d(s,{class:"pressure-chart-section"},{default:o(()=>[d(s,{class:"section-title"},{default:o(()=>[v("压力值变化曲线")]),_:1}),d(t,{ref_key:"pressureChartRef",ref:S,id:"pressureChart",class:"pressure-chart"},null,512)]),_:1}),d(s,{class:"hourly-list-section"},{default:o(()=>[d(s,{class:"section-title"},{default:o(()=>[v("24小时佩戴状态")]),_:1}),d(s,{class:"hourly-list"},{default:o(()=>[(c(),w(_,null,b(24,e=>d(s,{key:e,class:p(["hourly-item",j(e)])},{default:o(()=>[h("div",{class:"hour-time"},m(e.toString().padStart(2,"0"))+":00",1),h("div",{class:p(["hour-status",C(e)])},m(E(e)),3)]),_:2},1032,["class"])),64))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-25ed8d43"]]);export{P as default};
